{% extends 'core/base.html' %}
{% load static %}

{% block title %}Mon Panier{% endblock %}

{% block content %}
<div class="container py-5">

  <!-- HEADER -->
  <div class="page-header mb-5" style="background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); padding: 25px; border-radius: 15px;">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h2 class="fw-bold mb-1 text-light" style="font-size: 2.5rem;">
          <i class="fas fa-shopping-cart text-warning me-2"></i> Mon Panier
        </h2>
        <p class="text-light mb-0">
          Vérifiez vos produits avant paiement
        </p>
      </div>
      <a href="{% url 'produits' %}" class="btn btn-light shadow-sm">
        <i class="fas fa-arrow-left me-1"></i> Continuer mes achats
      </a>
    </div>
  </div>

  {% if panier %}

  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body">

      <div class="table-responsive">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th>Produit</th>
              <th>Prix (FC)</th>
              <th>Quantité</th>
              <th>Total (FC)</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for item in panier %}
            <tr>
              <td>{{ item.produit.nom }}</td>
              <td>{{ item.produit.prix }}</td>
              <td>{{ item.quantite }}</td>
              <td class="text-success fw-bold">
                    {{ item.total }} FC
                </td>
              <td>
                <a href="{% url 'supprimer_du_panier' item.produit.id %}" class="btn btn-danger btn-sm rounded-pill">
                  <i class="fas fa-trash"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- TOTAL GENERAL -->
      <div class="text-end mt-4">
        <h4>
          Total général :
          <span class="text-success fw-bold">
            {{ total }} FC
          </span>
        </h4>
      </div>

      <!-- BOUTON PAIEMENT -->
      <button type="button"
            class="btn btn-success btn-lg rounded-pill shadow-sm"
            data-bs-toggle="modal"
            data-bs-target="#confirmationModal">
            <i class="fas fa-credit-card me-2"></i>
            Payer mes produits
        </button>
    </div>
  </div>

  {% else %}

  <div class="text-center py-5">
    <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
    <p class="text-muted fs-5">Votre panier est vide.</p>
    <a href="{% url 'produits' %}" class="btn btn-primary rounded-pill">
      Voir nos produits
    </a>
  </div>

  {% endif %}

</div>

<!-- MODAL CONFIRMATION -->
<div class="modal fade" id="confirmationModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">

      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="fas fa-question-circle me-2"></i>
          Confirmation de paiement
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center py-4">
        <p class="fs-5">
          Voulez-vous confirmer votre paiement ?
        </p>
        <p class="fw-bold text-success">
          Montant total : {{ total }} FC
        </p>
      </div>

      <div class="modal-footer justify-content-center">
        <!-- NON -->
        <button type="button"
                class="btn btn-secondary rounded-pill px-4"
                data-bs-dismiss="modal">
          Non
        </button>

        <!-- OUI -->
        <a href="{% url 'payer_panier' %}"
           class="btn btn-success rounded-pill px-4">
          Oui
        </a>
      </div>

    </div>
  </div>
</div>

{% endblock %}
