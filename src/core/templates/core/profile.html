{% extends 'core/base.html' %}
{% load static %}
{% block title %}Mon Profil{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-auto px-0">
      <div class="sidebar d-flex flex-column align-items-center py-4">
        <button onclick="window.history.back()" 
                class="btn btn-light rounded-circle shadow-sm sidebar-btn">
          ‚Üê
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col">
      <div class="row g-4">

        <!-- BLOC GAUCHE : PROFIL -->
        <div class="col-lg-4">
          <div class="card border-0 shadow-sm rounded-4 h-100 profile-card">
            <div class="card-body text-center p-4">

              <div class="profile-photo-wrapper mx-auto mb-3">
                <img src="{% if profil.avatar %}{{ profil.avatar.url }}{% else %}{% static 'images/avatar.png' %}{% endif %}" 
                     alt="Avatar" class="profile-photo">
              </div>

              <h4 class="fw-bold mb-1">{{ user.username }}</h4>
              <p class="text-muted mb-3">{{ user.email }}</p>

              <span class="badge bg-primary px-3 py-2 rounded-pill">
                Membre Actif
              </span>

              <div class="mt-4">
                <a href="{% url 'modifier_profile' %}" 
                   class="btn btn-success w-100 rounded-pill py-2">
                  ‚úèÔ∏è Modifier le profil
                </a>
              </div>

            </div>
          </div>
        </div>

        <!-- BLOC DROITE : INFORMATIONS -->
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm rounded-4 h-100 info-main-card">
            <div class="card-body p-4">

              <h5 class="fw-semibold mb-4">Informations du compte</h5>

              <div class="row g-3 mb-3">
                <div class="col-md-6">
                  <div class="info-card">
                    <small>T√©l√©phone</small>
                    <div class="fw-semibold">{{ profil.telephone|default:"‚Äî" }}</div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="info-card">
                    <small>Solde</small>
                    <div class="fw-bold text-success">{{ profil.solde }} FC</div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="info-card">
                    <small>Gains retir√©s</small>
                    <div class="fw-semibold text-primary">{{ profil.gains_retires }} FC</div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="info-card">
                    <small>Statut paiement</small>
                    <div>
                      {% if profil.is_paid %}
                        <span class="badge bg-success">Pay√©</span>
                      {% else %}
                        <span class="badge bg-warning text-dark">En attente</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>

              <hr>

              <!-- Code parrainage -->
              <div class="mb-4">
                <small class="text-muted">Code de parrainage</small>
                <div class="d-flex justify-content-between align-items-center bg-light rounded px-3 py-2 mt-2">
                  <span id="codeParrainage" class="fw-semibold">{{ profil.mon_code|default:"‚Äî" }}</span>
                  <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                          onclick="copyCode()">Copier</button>
                </div>
              </div>

              <!-- Parrain & Filleuls -->
              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <div class="info-card text-center">
                    <small>Parrain</small>
                    <div class="fw-semibold">{{ profil.parrain.username|default:"Aucun" }}</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="info-card text-center">
                    <small>Mes filleuls</small>
                    <div class="fw-semibold">{{ nb_filleuls }}</div>
                  </div>
                </div>
              </div>

              <a href="{% url 'gains' %}" 
                 class="btn btn-primary w-100 rounded-pill py-2">
                üí∞ Consulter mon solde
              </a>

            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

<script>
function copyCode() {
  const code = document.getElementById("codeParrainage")?.innerText || "{{ profil.mon_code }}";
  navigator.clipboard.writeText(code);
  alert("Code copi√© : " + code);
}
</script>

<style>

/* Sidebar */
.sidebar {
  width: 80px;
}

.sidebar-btn {
  width: 45px;
  height: 45px;
}

/* Profil */
.profile-card {
  background: linear-gradient(145deg, #ffffff, #f8f9fa);
}

.profile-photo-wrapper {
  width: 140px;
  height: 140px;
  border-radius: 25px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.profile-photo {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Cartes info */
.info-card {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 16px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
}

.info-card small {
  display: block;
  color: #6c757d;
  margin-bottom: 4px;
}

.info-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}

.info-main-card {
  background: #ffffff;
}

</style>

{% endblock %}
